<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xshiver - Video Player</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fluid-player/3.46.0/fluidplayer.min.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <h1 class="logo"><a href="index.html">Xshiver</a></h1>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <div class="video-layout">
                <div class="video-player-section">
                    <div class="video-container" id="videoContainer">
                        <video id="videoPlayer" class="video-player" controls style="display: none;">
                            <source src="" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                        <div id="vimeoContainer" style="display: none;">
                            <!-- Vimeo embed will be inserted here -->
                        </div>
                        <div id="embedContainer" style="display: none;">
                            <!-- External embed (PixelDrain) will be inserted here -->
                        </div>
                    </div>
                    <div class="video-details">
                        <h1 class="current-video-title" id="currentVideoTitle">Loading...</h1>
                        <p class="video-meta" id="videoMeta">Please wait while video loads...</p>
                    </div>
                </div>
                
                <div class="suggestions-section">
                    <h2 class="suggestions-title">Suggested Videos</h2>
                    <div class="suggestions-list" id="suggestionsList">
                        <!-- Suggested videos will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/fluid-player/3.46.0/fluidplayer.min.js"></script>
    <script src="videos.js"></script>
    <script>
        let currentVideoId = null;
        let fluidPlayerInstance = null;

        function getVideoIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        function findVideoById(id) {
            return videos.find(video => video.id === id);
        }

        function initializePlayer(currentVideo) {
            const videoPlayer = document.getElementById('videoPlayer');
            const vimeoContainer = document.getElementById('vimeoContainer');
            const embedContainer = document.getElementById('embedContainer');
            
            // Hide all containers first
            videoPlayer.style.display = 'none';
            vimeoContainer.style.display = 'none';
            embedContainer.style.display = 'none';
            
            if (currentVideo.type === 'vimeo') {
                vimeoContainer.style.display = 'block';
                vimeoContainer.innerHTML = currentVideo.vimeoEmbed;
                
                if (!document.querySelector('script[src*="player.vimeo.com"]')) {
                    const script = document.createElement('script');
                    script.src = 'https://player.vimeo.com/api/player.js';
                    document.head.appendChild(script);
                }
                
                if (fluidPlayerInstance) {
                    fluidPlayerInstance.destroy();
                    fluidPlayerInstance = null;
                }
            } 
            else if (currentVideo.embedCode) {
                // Handle embedded content (PixelDrain)
                embedContainer.style.display = 'block';
                embedContainer.innerHTML = currentVideo.embedCode;
                
                if (fluidPlayerInstance) {
                    fluidPlayerInstance.destroy();
                    fluidPlayerInstance = null;
                }
            }
            else {
                // Regular MP4 video with Fluid Player
                videoPlayer.style.display = 'block';
                
                if (fluidPlayerInstance) {
                    fluidPlayerInstance.destroy();
                }

                fluidPlayerInstance = fluidPlayer('videoPlayer', {
                    layoutControls: {
                        fillToContainer: true,
                        primaryColor: '#ff4444',
                        playButtonShowing: true,
                        playPauseAnimation: true,
                        mute: {
                            text: 'Mute'
                        },
                        subtitlesEnabled: false,
                        keyboardControl: true,
                        layout: 'default',
                        allowDownload: false,
                        allowTheatre: true,
                        logo: {
                            imageUrl: null,
                            position: 'top-right',
                            clickUrl: null,
                            opacity: 0.8,
                            mouseOverImageUrl: null,
                            imageMargin: '2px',
                            hideWithControls: false,
                            showOverAds: false
                        }
                    }
                });

                videoPlayer.src = currentVideo.videoUrl;
            }
        }

        function loadCurrentVideo() {
            currentVideoId = getVideoIdFromUrl();
            
            if (!currentVideoId) {
                document.getElementById('currentVideoTitle').textContent = 'No video selected';
                document.getElementById('videoMeta').textContent = 'Please select a video from the homepage.';
                return;
            }

            const currentVideo = findVideoById(currentVideoId);
            
            if (!currentVideo) {
                document.getElementById('currentVideoTitle').textContent = 'Video not found';
                document.getElementById('videoMeta').textContent = 'The requested video could not be found.';
                return;
            }

            document.title = `${currentVideo.title} - Xshiver`;
            document.getElementById('currentVideoTitle').textContent = currentVideo.title;
            document.getElementById('videoMeta').textContent = `Duration: ${currentVideo.duration}`;

            initializePlayer(currentVideo);
        }

        function loadSuggestions() {
            const suggestionsList = document.getElementById('suggestionsList');
            
            const suggestions = videos
                .filter(video => video.id !== currentVideoId)
                .sort(() => Math.random() - 0.5)
                .slice(0, 6);

            suggestionsList.innerHTML = '';

            suggestions.forEach(video => {
                const suggestionCard = document.createElement('div');
                suggestionCard.className = 'suggestion-card';
                suggestionCard.onclick = () => openVideo(video.id);
                
                suggestionCard.innerHTML = `
                    <img src="${video.thumbnail}" alt="${video.title}" class="suggestion-thumbnail">
                    <div class="suggestion-info">
                        <h4 class="suggestion-title">${video.title}</h4>
                        <p class="suggestion-duration">${video.duration}</p>
                    </div>
                `;
                
                suggestionsList.appendChild(suggestionCard);
            });
        }

        function openVideo(videoId) {
            window.location.href = `video.html?id=${videoId}`;
        }

        document.addEventListener('DOMContentLoaded', function() {
            if (typeof videos === 'undefined') {
                document.getElementById('currentVideoTitle').textContent = 'Error loading videos';
                document.getElementById('videoMeta').textContent = 'Please check videos.js file.';
                return;
            }

            loadCurrentVideo();
            loadSuggestions();
        });
    </script>
</body>
</html>
